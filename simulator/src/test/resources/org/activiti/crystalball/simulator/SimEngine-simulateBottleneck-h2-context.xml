<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:activiti="http://www.activiti.org/schema/spring/components"
       xsi:schemaLocation="http://www.springframework.org/schema/beans   http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.activiti.org/schema/spring/components http://www.activiti.org/schema/spring/components/activiti.xsd">
	
	<!-- *************************************** -->
	<!--   SIMULATOR                             -->
	<!-- *************************************** -->
	<import resource="Simulator-simulateBottleneck-context.xml"/>
	                           
    <!-- property placeholder -->
	<bean id="placeholderConfig"
	      class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
	</bean>

	<!-- *************************************** -->
	<!-- SIMULATION PROCESS ENGINE               -->
	<!-- *************************************** -->    
	<bean id="simDataSource" class="org.springframework.jdbc.datasource.TransactionAwareDataSourceProxy">
        <property name="targetDataSource">
            <bean class="org.springframework.jdbc.datasource.SimpleDriverDataSource">
                <property name="driverClass" value="org.h2.Driver"/>
                <property name="url" value="jdbc:h2:${_SIM_DB_PATH};DB_CLOSE_DELAY=1000"/>
                <property name="username" value="sa"/>
                <property name="password" value=""/>
            </bean>
        </property>
    </bean>

    <bean id="simTransactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager" >
        <property name="dataSource" ref="simDataSource"/>
    </bean>

	<bean id="simProcessEngineConfiguration" class="org.activiti.spring.SpringProcessEngineConfiguration">
		<property name="dataSource" ref="simDataSource" />
		<property name="transactionManager" ref="simTransactionManager" />
		<property name="databaseSchemaUpdate" value="true" />
		<!-- job executor activation has to be disabled. Job executor has to be activated at the simulation run start -->
		<property name="jobExecutorActivate" value="false" />		
		<!-- property name="jobExecutor" ref="simDefaultJobExecutor"/-->		
		<property name="preParseListeners">
			<list>
				<bean class="org.activiti.crystalball.simulator.parse.SimulationBpmnParseListener">
					<constructor-arg ref="eventCalendar"/>
				</bean>
			</list>
		</property>
	</bean>
	
    <bean id="simProcessEngine" class="org.activiti.spring.ProcessEngineFactoryBean" >
        <property name="processEngineConfiguration" ref="simProcessEngineConfiguration"/>
    </bean>

    <bean id="simRepositoryService" factory-bean="simProcessEngine" factory-method="getRepositoryService"/>
    <bean id="simRuntimeService" factory-bean="simProcessEngine" factory-method="getRuntimeService"/>
    <bean id="simTaskService" factory-bean="simProcessEngine" factory-method="getTaskService"/>
    <bean id="simHistoryService" factory-bean="simProcessEngine" factory-method="getHistoryService"/>
    <bean id="simManagementService" factory-bean="simProcessEngine" factory-method="getManagementService"/>
    <bean id="simIdentityService" factory-bean="simProcessEngine" factory-method="getIdentityService"/>

	<!-- bean id="simDefaultJobExecutor" class="org.activiti.crystalball.simulator.processengine.jobexecutor.SimulationDefaultJobExecutor">
		<constructor-arg ref="eventCalendar"/>
	</bean-->
	
	<bean id="reportGenerator" class="org.activiti.crystalball.generator.ProcessInstancesGenerator">
        <property name="runtimeService" ref="simRuntimeService"/>
        <property name="repositoryService" ref="simRepositoryService"/>
        <!-- highlight nodes with more or eq to 5 instances -->	
        <property name="highlightColorIntervalList">
        	<list>
        		<bean class="org.activiti.crystalball.generator.ColorInterval">
        			<constructor-arg value="5" />
        			<constructor-arg value="red"/>
        		</bean>
        	</list>
        </property> 	
	</bean>
	
	<bean id="dueDateReportGenerator" class="org.activiti.crystalball.generator.DueDateGraphGenerator">
        <property name="repositoryService" ref="simRepositoryService"/>	
        <property name="historyService" ref="simHistoryService"/>	
		<!-- highlight nodes with more that 5% task instances after due date-->
		<property name="highlightColorIntervalList">
        	<list>
        		<bean class="org.activiti.crystalball.generator.ColorInterval">
        			<constructor-arg value="5" />
        			<constructor-arg value="red"/>
        		</bean>
        	</list>
        </property> 		
	</bean>
</beans>